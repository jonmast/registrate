@initMap = ->
  bounds = new google.maps.LatLngBounds()
  map = new google.maps.Map(document.getElementById('map'))
  $.getJSON '/users/locations', (locations)->
    locations.forEach (location)->
      marker = new google.maps.Marker
        map: map,
        position: {lat: location.latitude, lng: location.longitude},
        title: location.name
        icon: 'data:image/svg+xml;utf8,<svg height="45" viewBox="0 0 512 512" width="45" xmlns="http://www.w3.org/2000/svg"><g opacity=".12"><path fill="none" d="M39.722 383.945h407.444V511H39.722z"/><path d="M447.166 447.46c0 35.1-91.2 63.54-203.722 63.54-112.512 0-203.722-28.44-203.722-63.54 0-35.08 91.21-63.522 203.722-63.522 112.523 0 203.722 28.44 203.722 63.52" fill="#231F20"/></g><path d="M91.725 380.904s-16.017 18.854-4.715 47.117c11.305 28.27 73.505 15.085 75.387 0 0 0 49.95 8.485 36.757-33.93 0 0-5.657-9.41-12.247-13.187H91.725zM221.767 423.312s-26.38 26.38 0 53.71c26.385 27.33 92.356 11.31 86.708-11.308 0 0 70.672 13.2 58.426-32.98-12.247-46.177-26.51-34.875-26.51-34.875L221.766 423.31z" fill="#989897"/><path d="M98.318 309.28s7.545 36.748-6.59 71.618c0 0 12.244 32.99 58.422 11.314 0 0 34.866 9.423 36.754-11.314V354.44s-53.72-48.928-88.586-45.16M219.886 362.052s6.596 28.276 1.88 61.26c0 0 44.3 37.69 75.4 0 0 0 46.272 8.99 48.104-26.587 0 0-17.955-22.42-24.555-53.52l-100.83 18.847z" fill="#F3CBA2"/><path d="M91.725 292.325s-25.453 35.802-44.293 0c0 0-40.52 1.878-20.73-28.276 0 0-30.69-14.14-5.448-30.156 0 0-4.922-35.815 19.582-14.138 0 0-4.715-27.324 17.908-28.276l32.98 100.845z" fill="#D0D2D3"/><path d="M282.582 359.228s-19.346 49.947-52.33 5.66c0 0-46.175 39.204-53.72-10.546 0 0-55.6 18.072-55.6-35.638 0 0-54.654 8.484-43.343-45.24 0 0-50.894-14.124-20.74-55.593 0 0-33.916-29.208 1.89-45.238 0 0-32.043-44.283 14.134-52.77 0 0-32.982-61.253 41.462-55.595 0 0 9.53-49 48.105-25.44 0 0 11.266-42.412 52.735-12.26 0 0 38.685-55.594 67.405-2.824 0 0 59.816-22.613 49.44 34.866 0 0 68.794-14.136 46.18 55.597l-46.18 213.92c.003 0-6.538 50.887-49.438 31.1" fill="#F1F1F2"/><path d="M324.484 157.562s-33.917-60.313-94.236-39.582c0 0-15.074 65.028 64.096 81.997 0 0-66.92 144.18 41.45 160.197 0 0 38.638 60.31 84.815 20.73 0 0 45.23 37.688 71.616-37.7 26.393-75.386-1.877-87.634-29.21-133.81 0 0 49.003-14.33 35.817-95.745 0 0-51.84-3.206-75.395 25.06l-98.954 18.852z" fill="#F3CBA2"/><path d="M451.71 327.188s-26.937 39.525-68.94 0M354.646 327.188s-26.385-1.892-26.385-29.216M423.44 344.755s8.103 28.525-2.83 36.144M334.447 316.938s-12.037 27.476 1.352 43.236" fill="none" stroke="#C8A988" stroke-linecap="round" stroke-miterlimit="10" stroke-width="4.747"/><path d="M442.287 232.01c0 9.08 4.21 16.442 9.422 16.442 5.2 0 9.423-7.36 9.423-16.443 0-9.083-4.223-16.444-9.424-16.444-5.214 0-9.423 7.36-9.423 16.443M345.217 232.01c0 9.08 4.21 16.442 9.422 16.442 5.2 0 9.43-7.36 9.43-16.443 0-9.083-4.23-16.444-9.43-16.444-5.214 0-9.423 7.36-9.423 16.443" fill="#434445"/><path d="M311.3 192.11s10.835-64.707-67.853-59.053c0 0-.942 49.767 67.852 59.052M480.92 136.36s-47.453-14.604-54.598 47.593c0 0 50.356 18.368 54.598-47.593" fill="#F6B5CE"/><path d="M417.234 113.534s-15.918-39.37-48.902-6.865c0 0-46.672-31.095-45.725 15.552 0 0-51.012 14.79-6.127 42.412 0 0-15.925 48.056 28.78 31.094 0 0 14.567 37.41 45.194 3.63 0 0 36.42 30.294 35.867-19.174 0 0 44.722-2.91 11.966-30.424 0 0 29.77-43.495-21.052-36.226" fill="#D0D2D3"/></svg>'
      bounds.extend(marker.position)
      infoWindow = new google.maps.InfoWindow
        content: "<h3>#{location.flock_name}</h3><b>#{location.name}</b><br /><a href='/users/#{location.id}'>More Details &hellip;</a>"
      marker.addListener 'click', ->
        infoWindow.open(map, marker)
      google.maps.event.addListener map, 'click', ->
        infoWindow.close()
    map.fitBounds(bounds)
